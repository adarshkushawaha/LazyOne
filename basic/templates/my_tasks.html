{% extends 'base.html' %}

{% block title %}My Tasks{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h2 class="text-3xl font-bold text-white mb-8 text-center">My Tasks</h2>

    <!-- Tab Navigation -->
    <div class="mb-8">
        <div class="border-b border-gray-700">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                <button id="tab-posted" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg text-cyan-400 border-cyan-400">
                    Posted Tasks
                </button>
                <button id="tab-taken" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg text-gray-400 hover:text-white hover:border-gray-300 border-transparent">
                    Taken Tasks
                </button>
            </nav>
        </div>
    </div>

    <!-- Tab Content -->
    <div id="content-posted" class="space-y-4">
        {% for task in posted_tasks %}
            <div class="bg-gray-800/50 border border-gray-700/50 rounded-xl p-5 transition-all duration-300 hover:shadow-cyan-500/20 hover:shadow-lg hover:border-cyan-500/50">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-lg font-bold text-white">{{ task.title }}</h3>
                        <p class="text-sm text-gray-400 mt-1">
                            Status: 
                            {% if task.is_completed %}<span class="text-green-400">Completed by {{ task.taken_by.username }}</span>
                            {% elif task.is_taken %}<span class="text-amber-400">In progress by {{ task.taken_by.username }}</span>
                            {% else %}<span class="text-cyan-400">Waiting for taker</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="text-right flex-shrink-0 ml-4">
                        <p class="text-xl font-semibold text-cyan-400">{{ task.reward }}</p>
                        <p class="text-xs text-gray-500">Points</p>
                    </div>
                </div>
                <div class="mt-4 flex items-center space-x-3">
                    {% if task.is_completed %}
                        {% if task.conversation %}
                            <a href="{% url 'chat_view' task.conversation.id %}" class="inline-block bg-gray-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-gray-500 transition-colors text-sm">View Chat</a>
                        {% endif %}
                    {% elif task.is_taken %}
                        <a href="{% url 'complete_task' task.id %}" class="inline-block bg-green-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-green-500 transition-colors text-sm">Mark as Complete</a>
                        {% if task.conversation %}
                            <a href="{% url 'chat_view' task.conversation.id %}" class="inline-block bg-cyan-500/80 text-white font-semibold px-4 py-2 rounded-lg hover:bg-cyan-500 transition-colors text-sm">Go to Chat</a>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        {% empty %}
            <div class="bg-gray-800/50 border border-gray-700/50 rounded-xl p-8 text-center">
                <p class="text-gray-400">You haven't posted any tasks yet.</p>
            </div>
        {% endfor %}
    </div>

    <div id="content-taken" class="space-y-4 hidden">
        {% for task in taken_tasks %}
            <div class="bg-gray-800/50 border border-gray-700/50 rounded-xl p-5 transition-all duration-300 hover:shadow-cyan-500/20 hover:shadow-lg hover:border-cyan-500/50">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-lg font-bold text-white">{{ task.title }}</h3>
                        <p class="text-sm text-gray-400 mt-1">Posted by: {{ task.posted_by.username }}</p>
                    </div>
                    <div class="text-right flex-shrink-0 ml-4">
                        <p class="text-xl font-semibold text-cyan-400">{{ task.reward }}</p>
                        <p class="text-xs text-gray-500">Points</p>
                    </div>
                </div>
                <p class="text-gray-300 mt-3">{{ task.description }}</p>
                <div class="mt-4 flex items-center space-x-3">
                    {% if task.is_completed %}
                        <p class="text-green-400 font-semibold">Task Completed</p>
                        {% if task.conversation %}
                            <a href="{% url 'chat_view' task.conversation.id %}" class="inline-block bg-gray-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-gray-500 transition-colors text-sm">View Chat</a>
                        {% endif %}
                    {% else %}
                        <p class="text-amber-400 font-semibold">In Progress</p>
                        {% if task.conversation %}
                            <a href="{% url 'chat_view' task.conversation.id %}" class="inline-block bg-cyan-500/80 text-white font-semibold px-4 py-2 rounded-lg hover:bg-cyan-500 transition-colors text-sm">Go to Chat</a>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        {% empty %}
            <div class="bg-gray-800/50 border border-gray-700/50 rounded-xl p-8 text-center">
                <p class="text-gray-400">You haven't taken any tasks yet.</p>
            </div>
        {% endfor %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tabPosted = document.getElementById('tab-posted');
        const tabTaken = document.getElementById('tab-taken');
        const contentPosted = document.getElementById('content-posted');
        const contentTaken = document.getElementById('content-taken');

        tabPosted.addEventListener('click', () => {
            // Activate Posted tab
            tabPosted.classList.add('text-cyan-400', 'border-cyan-400');
            tabPosted.classList.remove('text-gray-400', 'hover:text-white', 'hover:border-gray-300', 'border-transparent');
            // Deactivate Taken tab
            tabTaken.classList.add('text-gray-400', 'hover:text-white', 'hover:border-gray-300', 'border-transparent');
            tabTaken.classList.remove('text-cyan-400', 'border-cyan-400');
            // Show Posted content
            contentPosted.classList.remove('hidden');
            contentTaken.classList.add('hidden');
        });

        tabTaken.addEventListener('click', () => {
            // Activate Taken tab
            tabTaken.classList.add('text-cyan-400', 'border-cyan-400');
            tabTaken.classList.remove('text-gray-400', 'hover:text-white', 'hover:border-gray-300', 'border-transparent');
            // Deactivate Posted tab
            tabPosted.classList.add('text-gray-400', 'hover:text-white', 'hover:border-gray-300', 'border-transparent');
            tabPosted.classList.remove('text-cyan-400', 'border-cyan-400');
            // Show Taken content
            contentTaken.classList.remove('hidden');
            contentPosted.classList.add('hidden');
        });
    });
</script>
{% endblock %}
